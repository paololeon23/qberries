<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Cosecha - Agrovision</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2f7cc0">
    <link rel="icon" type="image/png" href="icono.png">
    <link rel="stylesheet" href="librerias/sweetalert2.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <nav id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <div class="brand">
                <img src="logo2.png" alt="Agrovision Logo" class="sidebar-logo">
            </div>
            <button id="close-btn" class="icon-btn" title="Cerrar men√∫">
                <i data-lucide="x-circle"></i>
            </button>
        </div>
        <ul>
            <li><a href="#" class="active nav-link" data-view="nueva"><i data-lucide="plus-circle"></i> Nueva Cosecha</a></li>
            <li><a href="#" class="nav-link" data-view="historial"><i data-lucide="history"></i> Historial</a></li>
            <li><a href="#" class="nav-link" data-view="recomendaciones"><i data-lucide="settings"></i> Recomendaciones</a></li>
        </ul>
    </nav>

    <main class="main-content">
        <header>
            <button id="menu-btn" class="menu-btn"><i data-lucide="menu"></i> Men√∫</button>
            <h1>MTTP AR√ÅNDANO</h1>
            
            <div id="network-status-container" class="status-card online">
                <div class="status-info">
                    <span id="status-dot">‚óè</span>
                    <span id="status-text">En l√≠nea</span>
                </div>
                
                <span id="pending-count">Pendientes: 0</span>
            </div>
        </header>
        
        <form id="cosecha-form">

            <div class="form-group form-inline main-card">
                <label for="tipo_medicion">
                    <i data-lucide="layers"></i> Tipo de Medici√≥n:
                </label>
                <select id="tipo_medicion" name="tipo_medicion" class="select-modern" required>
                    <option value="" disabled selected>Seleccione para comenzar...</option>
                    <option value="visual">Calibrado Visual</option>
                    <option value="packing">Calibrado Packing</option>
                </select>
            </div>

            <div id="view_visual_container">
            <section class="form-group">
                <div class="row">
                    <div class="col">
                        <label><i data-lucide="calendar"></i> Fecha</label>
                        <input type="date" id="reg_fecha" name="reg_fecha" required>
                    </div>
                    <div class="col">
                        <label><i data-lucide="user"></i> Responsable</label>
                        <input type="text" id="reg_responsable" name="reg_responsable" placeholder="Antony Siesqu√©n" required>
                    </div>
                </div>

                <div class="row">
                    <div class="col">
                        <label><i data-lucide="map-pin"></i> Trazabilidad</label>
                        <div class="input-group-triple">
                            <select id="reg_traz_etapa" name="reg_traz_etapa" required>
                                <option value="" disabled selected>Etapa</option>
                                <option value="1">E1</option>
                                <option value="2">E2</option>
                                <option value="3">E3</option>
                                <option value="4">E4</option>
                                <option value="5">E5</option>
                                <option value="6">E6</option>
                                <option value="7">E7</option>
                                <option value="8">E8</option>
                                <option value="9">E9</option>
                            </select>

                            <select id="reg_traz_campo" name="reg_traz_campo" required>
                                <option value="" disabled selected>Campo</option>
                                <option value="1">C1</option>
                                <option value="2">C2</option>
                                <option value="3">C3</option>
                                <option value="4">C4</option>
                                <option value="5">C5</option>
                                <option value="6">C6</option>
                                <option value="7">C7</option>
                                <option value="8">C8</option>
                                <option value="9">C9</option>
                            </select>

                            <input type="text" oninput="this.value = this.value.toUpperCase().replace(/[^A-Z0-9]/g, '')"  id="reg_traz_libre" name="reg_traz_libre" placeholder="T4A" maxlength="3" style="text-transform: uppercase;">
                        </div>
                    </div>
                    <div class="col">
                        <label><i data-lucide="file-text"></i> Gu√≠a Remisi√≥n Acopio</label>
                        <input type="text" inputmode="numeric" oninput="this.value = this.value.replace(/[^0-9]/g, '')" id="reg_guia_remision" name="reg_guia_remision" placeholder="200416" maxlength="6" required>
                    </div>
                </div>

                <div class="row">
                    <div class="col">
                        <label><i data-lucide="leaf"></i> Variedad</label>
                        <div class="input-group-triple">
                            <select id="reg_variedad" name="reg_variedad" required>
                                <option value="" disabled selected>--- Seleccione Variedad ---</option>
                                </select>
                        </div>
                    </div>
                    <div class="col">
                        <label><i data-lucide="truck"></i> Placa Veh√≠culo</label>
                        <input type="text" oninput="this.value = this.value.replace(/[^A-Za-z0-9-]/g, '')" id="reg_placa" name="reg_placa" placeholder="9578-PK" maxlength="7" style="text-transform: uppercase;" required>
                    </div>
                </div>

                <div class="row">

                    <div class="col">
                        <label><i data-lucide="clock"></i> Hora Inicio General</label>
                        <input type="time" id="reg_hora_inicio" name="reg_hora_inicio" value="07:15" required>
                    </div>
                    <div class="col">
                        <label><i data-lucide="calendar-days"></i> D√≠as Precosecha / N¬∞</label>
                        <input type="text" id="reg_dias_precosecha" name="reg_dias_precosecha" placeholder="6, 29">
                    </div>
                </div>
            </section>

            <hr>

            <div class="form-group form-inline main-card">
                <label for="tipo_medicion">
                    <i data-lucide="layers"></i> R√≥tulo de Muestra:
                </label>
                    <select id="reg_rotulo_ensayo" name="reg_rotulo_ensayo" class="select-modern" required>
                        <option value="" disabled selected>Seleccione para comenzar...</option>
                        <option value="1">Ensayo 1</option>
                        <option value="2">Ensayo 2</option>
                        <option value="3">Ensayo 3</option>
                        <option value="4">Ensayo 4</option>
                    </select>
            </div>


<div id="wrapper_jarras" class="collapsible-wrapper" style="display: none;">
    <div class="collapsible-card">
        <div class="card-header collapsible-toggle" data-target="body-jarras">
            <div class="header-info">
                <i data-lucide="timer"></i>
                <span>TIEMPO DE LLENADO DE JARRAS (HORA)</span>
            </div>
            <i data-lucide="chevron-down" class="chevron"></i>
        </div>

        <div class="card-body" id="body-jarras">
            <div class="table-scroll">
                <table class="table-field-style">
                    <thead>
                        <tr>
                            <th class="b-left">ITEM</th> 
                            <th>N¬∞ JARRA</th>
                            <th style="width: 26%;">TIPO</th>
                            <th title="Hora Inicio"><i data-lucide="play-circle"></i><br>INICIO</th>
                            <th title="Hora T√©rmino"><i data-lucide="check-circle"></i><br>T√âRMINO</th>
                            <th title="Tiempo Empleado"><i data-lucide="hourglass"></i><br>TOTAL</th>
                            <th class="b-right">ACCION</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="input-table-row">
                            <td class="b-left">
                                <span id="next_row_jarras">1</span> 
                            </td>
                            <td>
                                <input type="number" id="reg_jarras_n_jarra" name="reg_jarras_n_jarra" placeholder="ID Jarra" inputmode="numeric" min="1" step="1">
                            </td>
                            <td>
                                <select id="reg_jarras_tipo" name="reg_jarras_tipo" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                                    <option value="" disabled selected>Selecciona...</option>
                                    <option value="C">Cosecha</option>
                                    <option value="T">Traslado</option>
                                </select>
                            </td>
                            <td>
                                <input type="time" id="reg_jarras_inicio" name="reg_jarras_inicio">
                            </td>
                            <td>
                                <input type="time" id="reg_jarras_termino" name="reg_jarras_termino">
                            </td>
                            <td>
                                <span id="reg_jarras_tiempo" style="font-weight: bold; color: #555;">0'</span>
                            </td>
                            <td class="b-right">
                                <button type="button" id="btn-add-jarras" class="btn-mini-add">
                                    <i data-lucide="plus"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                    <tbody id="tbody-jarras">
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div id="wrapper_visual" class="collapsible-wrapper" style="display: none;">
    <div class="collapsible-card">
        <div class="card-header collapsible-toggle" data-target="body-visual">
            <div class="header-info">
                <i data-lucide="scale"></i>
                <span>ENTRADA DE PESOS: VISUAL</span>
            </div>
            <i data-lucide="chevron-down" class="chevron"></i>
        </div>

        <div class="card-body" id="body-visual">
            <div class="table-scroll">
                <table class="table-field-style">
                    <thead>
                        <tr>
                            <th rowspan="2" class="b-left">N¬∞ CLAM</th>
                            <th rowspan="2">N¬∞ JARRA</th>
                            <th colspan="4">PESO BRUTO (G)</th>
                            <th rowspan="2" class="b-right">ACCION</th>
                        </tr>
                        <tr class="sub-header-icons">
                            <th title="Peso 1">P1</th>
                            <th title="Peso 2">P2</th>
                            <th title="Llegada Acopio"><i data-lucide="warehouse"></i><br>LLEG.</th>
                            <th title="Despacho Acopio"><i data-lucide="truck"></i><br>DESP.</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="input-table-row">
                            <td class="b-left"><span id="next_clam_visual">0</span></td>
                            <td><input type="number" id="reg_visual_n_jarra" name="reg_visual_n_jarra" placeholder="0" inputmode="numeric" min="1" step="1"></td>
                            <td><input type="number" id="reg_visual_peso_1" name="reg_visual_peso_1" placeholder="0.0" step="0.1" inputmode="decimal" min="0"></td>
                            <td><input type="number" id="reg_visual_peso_2" name="reg_visual_peso_2" placeholder="0.0" step="0.1" inputmode="decimal" min="0"></td>
                            <td><input type="number" id="reg_visual_llegada_acopio" name="reg_visual_llegada_acopio" placeholder="0.0" step="0.1" inputmode="decimal" min="0"></td>
                            <td><input type="number" id="reg_visual_despacho_acopio" name="reg_visual_despacho_acopio" placeholder="0.0" step="0.1" inputmode="decimal" min="0"></td>
                            <td class="b-right">
                                <button type="button" id="btn-add-visual" class="btn-mini-add">
                                    <i data-lucide="plus"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                    <tbody id="tbody-visual">
                        </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div id="wrapper_tiempos" class="collapsible-wrapper" style="display: none;">
    <div class="collapsible-card">
        <div class="card-header collapsible-toggle" data-target="body-tiempos">
            <div class="header-info">
                <i data-lucide="clock"></i>
                <span>TIEMPOS DE LA MUESTRA (HORA)</span>
            </div>
            <i data-lucide="chevron-down" class="chevron"></i>
        </div>

        <div class="card-body" id="body-tiempos">
            <div class="table-scroll">
                <table class="table-field-style">
                    <thead>
                        <tr>
                            <th class="b-left">N¬∞ CLAM</th>
                            <th title="Inicio Cosecha"><i data-lucide="play-circle"></i><br>INICIO</th>
                            <th title="P√©rdida de Peso"><i data-lucide="trending-down"></i><br>P√âRDIDA</th>
                            <th title="T√©rmino Cosecha"><i data-lucide="check-circle"></i><br>T√âRMINO</th>
                            <th title="Llegada Acopio"><i data-lucide="warehouse"></i><br>LLEGADA</th>
                            <th title="Despacho Acopio"><i data-lucide="truck"></i><br>DESPACHO</th>
                            <th class="b-right">ACCION</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="input-table-row">
                            <td class="b-left"><span id="next_clam_tiempos">0</span></td>
                            <td><input type="time" id="reg_tiempos_inicio_c" name="reg_tiempos_inicio_c"></td>
                            <td><input type="time" id="reg_tiempos_perdida_peso" name="reg_tiempos_perdida_peso"></td>
                            <td><input type="time" id="reg_tiempos_termino_c" name="reg_tiempos_termino_c"></td>
                            <td><input type="time" id="reg_tiempos_llegada_acopio" name="reg_tiempos_llegada_acopio"></td>
                            <td><input type="time" id="reg_tiempos_despacho_acopio" name="reg_tiempos_despacho_acopio"></td>
                            <td class="b-right">
                                <button type="button" id="btn-add-tiempos" class="btn-mini-add">
                                    <i data-lucide="plus"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                    <tbody id="tbody-tiempos">
                        </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div id="wrapper_temperaturas" class="collapsible-wrapper" style="display: none;">
    <div class="collapsible-card">
        <div class="card-header collapsible-toggle" data-target="body-temperaturas">
            <div class="header-info">
                <i data-lucide="thermometer"></i>
                <span>TEMPERATURA MUESTRA (¬∞C)</span>
            </div>
            <i data-lucide="chevron-down" class="chevron"></i>
        </div>

        <div class="card-body" id="body-temperaturas">
            <div class="table-scroll">
                <table class="table-field-style">
                    <thead>
                        <tr>
                            <th rowspan="2" class="b-left">N¬∞ CLAM</th>
                            <th colspan="2">INICIO</th>
                            <th colspan="2">T√âRMINO</th>
                            <th colspan="2">LLEGADA ACOPIO</th>
                            <th colspan="2">DESPACHO ACOPIO</th>
                            <th rowspan="2" class="b-right">ACCION</th>
                        </tr>
                        <tr class="sub-header-icons">
                            <th title="T¬∞ Ambiente"><i data-lucide="thermometer-sun"></i></th>
                            <th title="T¬∞ Pulpa (Fruta)"><i data-lucide="cherry"></i></th>
                            <th title="T¬∞ Ambiente"><i data-lucide="thermometer-sun"></i></th>
                            <th title="T¬∞ Pulpa (Fruta)"><i data-lucide="cherry"></i></th>
                            <th title="T¬∞ Ambiente"><i data-lucide="thermometer-sun"></i></th>
                            <th title="T¬∞ Pulpa (Fruta)"><i data-lucide="cherry"></i></th>
                            <th title="T¬∞ Ambiente"><i data-lucide="thermometer-sun"></i></th>
                            <th title="T¬∞ Pulpa (Fruta)"><i data-lucide="cherry"></i></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="input-table-row">
                            <td class="b-left"><span id="next_clam_temp">0</span></td>
                            <td><input type="number" id="reg_temp_inicio_amb" name="reg_temp_inicio_amb" placeholder="0.0" step="0.1" min="0"></td>
                            <td><input type="number" id="reg_temp_inicio_pul" name="reg_temp_inicio_pul" placeholder="0.0" step="0.1" min="0"></td>
                            <td><input type="number" id="reg_temp_termino_amb" name="reg_temp_termino_amb" placeholder="0.0" step="0.1" min="0"></td>
                            <td><input type="number" id="reg_temp_termino_pul" name="reg_temp_termino_pul" placeholder="0.0" step="0.1" min="0"></td>
                            <td><input type="number" id="reg_temp_llegada_amb" name="reg_temp_llegada_amb" placeholder="0.0" step="0.1" min="0"></td>
                            <td><input type="number" id="reg_temp_llegada_pul" name="reg_temp_llegada_pul" placeholder="0.0" step="0.1" min="0"></td>
                            <td><input type="number" id="reg_temp_despacho_amb" name="reg_temp_despacho_amb" placeholder="0.0" step="0.1" min="0"></td>
                            <td><input type="number" id="reg_temp_despacho_pul" name="reg_temp_despacho_pul" placeholder="0.0" step="0.1" min="0"></td>
                            <td class="b-right">
                                <button type="button" id="btn-add-temperaturas" class="btn-mini-add">
                                    <i data-lucide="plus"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                    <tbody id="tbody-temperaturas"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div id="wrapper_humedad" class="collapsible-wrapper" style="display: none;">
    <div class="collapsible-card">
        <div class="card-header collapsible-toggle" data-target="body-humedad">
            <div class="header-info">
                <i data-lucide="droplets"></i>
                <span>HUMEDAD RELATIVA (%)</span>
            </div>
            <i data-lucide="chevron-down" class="chevron"></i>
        </div>

        <div class="card-body" id="body-humedad">
            <div class="table-scroll">
                <table class="table-field-style">
                    <thead>
                        <tr>
                            <th class="b-left">N¬∞ CLAM</th>
                            <th title="Inicio Cosecha"><i data-lucide="cloud-rain"></i><br>INICIO</th>
                            <th title="T√©rmino Cosecha"><i data-lucide="cloud-off"></i><br>T√âRMINO</th>
                            <th title="Llegada Acopio"><i data-lucide="warehouse"></i><br>LLEGADA</th>
                            <th title="Despacho Acopio"><i data-lucide="truck"></i><br>DESPACHO</th>
                            <th class="b-right">ACCION</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="input-table-row">
                            <td class="b-left"><span id="next_clam_humedad">0</span></td>
                            <td><input type="number" id="reg_humedad_inicio" name="reg_humedad_inicio" placeholder="0%" step="0.1" inputmode="decimal" min="0"></td>
                            <td><input type="number" id="reg_humedad_termino" name="reg_humedad_termino" placeholder="0%" step="0.1" inputmode="decimal" min="0"></td>
                            <td><input type="number" id="reg_humedad_llegada" name="reg_humedad_llegada" placeholder="0%" step="0.1" inputmode="decimal" min="0"></td>
                            <td><input type="number" id="reg_humedad_despacho" name="reg_humedad_despacho" placeholder="0%" step="0.1" inputmode="decimal" min="0"></td>
                            <td class="b-right">
                                <button type="button" id="btn-add-humedad" class="btn-mini-add">
                                    <i data-lucide="plus"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                    <tbody id="tbody-humedad">
                        </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div id="wrapper_presionambiente" class="collapsible-wrapper" style="display: none;">
    <div class="collapsible-card">
        <div class="card-header collapsible-toggle" data-target="body-presion">
            <div class="header-info">
                <i data-lucide="gauge"></i>
                <span>PRESI√ìN DE VAPOR AMBIENTE (Kpa)</span>
            </div>
            <i data-lucide="chevron-down" class="chevron"></i>
        </div>

        <div class="card-body" id="body-presion">
            <div class="table-scroll">
                <table class="table-field-style">
                    <thead>
                        <tr>
                            <th class="b-left">N¬∞ CLAM</th>
                            <th title="Inicio Cosecha"><i data-lucide="wind"></i><br>INICIO</th>
                            <th title="T√©rmino Cosecha"><i data-lucide="wind"></i><br>T√âRMINO</th>
                            <th title="Llegada Acopio"><i data-lucide="warehouse"></i><br>LLEGADA</th>
                            <th title="Despacho Acopio"><i data-lucide="truck"></i><br>DESPACHO</th>
                            <th class="b-right">ACCION</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="input-table-row">
                            <td class="b-left"><span id="next_clam_presion">0</span></td>
                            <td><input type="number" id="reg_presion_amb_inicio" name="reg_presion_amb_inicio" placeholder="0.000" step="0.001" inputmode="decimal" min="0"></td>
                            <td><input type="number" id="reg_presion_amb_termino" name="reg_presion_amb_termino" placeholder="0.000" step="0.001" inputmode="decimal" min="0"></td>
                            <td><input type="number" id="reg_presion_amb_llegada" name="reg_presion_amb_llegada" placeholder="0.000" step="0.001" inputmode="decimal" min="0"></td>
                            <td><input type="number" id="reg_presion_amb_despacho" name="reg_presion_amb_despacho" placeholder="0.000" step="0.001" inputmode="decimal" min="0"></td>
                            <td class="b-right">
                                <button type="button" id="btn-add-presion" class="btn-mini-add">
                                    <i data-lucide="plus"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                    <tbody id="tbody-presion">
                        </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div id="wrapper_presionfruta" class="collapsible-wrapper" style="display: none;">
    <div class="collapsible-card">
        <div class="card-header collapsible-toggle" data-target="body-presion-fruta">
            <div class="header-info">
                <i data-lucide="cherry"></i>
                <span>PRESI√ìN DE VAPOR FRUTA (Kpa)</span>
            </div>
            <i data-lucide="chevron-down" class="chevron"></i>
        </div>

        <div class="card-body" id="body-presion-fruta">
            <div class="table-scroll">
                <table class="table-field-style">
                    <thead>
                        <tr>
                            <th class="b-left">N¬∞ CLAM</th>
                            <th title="Inicio Cosecha"><i data-lucide="play-circle"></i><br>INICIO</th>
                            <th title="T√©rmino Cosecha"><i data-lucide="check-circle"></i><br>T√âRMINO</th>
                            <th title="Llegada Acopio"><i data-lucide="warehouse"></i><br>LLEGADA</th>
                            <th title="Despacho Acopio"><i data-lucide="truck"></i><br>DESPACHO</th>
                            <th rowspan="2" class="b-right">ACCION</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="input-table-row">
                            <td class="b-left"><span id="next_clam_presion_fruta">0</span></td>
                            <td><input type="number" id="reg_presion_fruta_inicio" name="reg_presion_fruta_inicio" placeholder="0.000" step="0.001" inputmode="decimal" min="0"></td>
                            <td><input type="number" id="reg_presion_fruta_termino" name="reg_presion_fruta_termino" placeholder="0.000" step="0.001" inputmode="decimal" min="0"></td>
                            <td><input type="number" id="reg_presion_fruta_llegada" name="reg_presion_fruta_llegada" placeholder="0.000" step="0.001" inputmode="decimal" min="0"></td>
                            <td><input type="number" id="reg_presion_fruta_despacho" name="reg_presion_fruta_despacho" placeholder="0.000" step="0.001" inputmode="decimal" min="0"></td>
                            <td class="b-right">
                                <button type="button" id="btn-add-presion-fruta" class="btn-mini-add">
                                    <i data-lucide="plus"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                    <tbody id="tbody-presion-fruta">
                        </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div id="wrapper_observacion" class="collapsible-wrapper" style="display: none;">
    <div class="collapsible-card">
        <div class="card-header collapsible-toggle" data-target="body-observacion">
            <div class="header-info">
                <i data-lucide="sticky-note"></i>
                <span>OBSERVACIONES POR MUESTRA</span>
            </div>
            <i data-lucide="chevron-down" class="chevron"></i>
        </div>

        <div class="card-body" id="body-observacion">
            <div class="table-scroll">
                <table class="table-field-style">
                    <thead>
                        <tr>
                            <th class="b-left" style="width: 80px;">N¬∞ CLAM</th>
                            <th>DETALLE DE LA OBSERVACI√ìN</th>
                            <th class="b-right" style="width: 80px;">ACCION</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="input-table-row">
                            <td class="b-left">
                                <span id="next_clam_obs">0</span>
                            </td>
                            <td>
                                <input type="text" id="reg_observacion_texto" name="reg_observacion_texto" placeholder="Escriba aqu√≠ la nota de la muestra...">
                            </td>
                            <td class="b-right">
                                <button type="button" id="btn-add-obs" class="btn-mini-add">
                                    <i data-lucide="plus"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                    <tbody id="tbody-observacion">
                        </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
            </div>

            <div id="view_packing_container" class="packing-container" style="display: none;">
                <!-- Bloque 1: Fecha, Ensayo, Cargar datos -->
                <div class="form-group packing-fecha-ensayo-row" style="margin-bottom: 1rem;">
                    <div class="row row-fecha-ensayo">
                        <div class="col col-fecha">
                            <label><i data-lucide="calendar"></i> Fecha</label>
                            <input type="date" id="view_fecha" name="view_fecha">
                        </div>
                        <div class="col col-ensayo">
                            <label><i data-lucide="layers"></i> Ensayo</label>
                            <div class="ensayo-select-wrap">
                                <select id="view_ensayo_numero" name="view_ensayo_numero" class="select-modern">
                                    <option value="" disabled selected>Seleccione fecha primero...</option>
                                </select>
                                <span id="spinner_ensayos" class="loading-spinner" aria-hidden="true" style="display: none;"></span>
                            </div>
                        </div>

                    </div>
                                            <div class="col col-btn-cargar" style="display: flex; align-items: flex-end;">
                            <button type="button" id="btn_cargar_datos" class="btn-primary-blue btn-cargar-datos" style="padding: 8px 16px;">
                                <span class="btn-cargar-text">Cargar datos</span>
                                <span id="spinner_cargar" class="loading-spinner btn-spinner" aria-hidden="true" style="display: none;"></span>
                            </button>
                        </div>
                    <p id="view_no_ensayos_msg" class="view-only-hint view-no-ensayos-msg" style="display: none; margin: 10px 0 0 0; font-size: 0.85rem; color: #b45309;" role="status" aria-live="polite"><i data-lucide="alert-circle"></i> No hay ensayos en esa fecha. Busca otra fecha por favor.</p>
                </div>

                <!-- Bloque 2: Datos de la hoja (solo visualizaci√≥n) -->
                <section id="packing_datos_section" class="form-group datos-cargados-solo-lectura">
                    <p class="view-only-hint" style="margin: 0 0 12px 0; font-size: 0.85rem; color: #555;"><i data-lucide="info"></i> Datos de la hoja: solo visualizaci√≥n. Se usar√°n al agregar registros en Packing.</p>
                    <div class="row">
                        <div class="col">
                            <label><i data-lucide="clock"></i> Hora Inicio Recepci√≥n</label>
                            <input type="time" id="view_hora_recepcion" name="view_hora_recepcion">
                        </div>
                        <div class="col">
                            <label class="view-only-label"><i data-lucide="tag"></i> Ensayos</label>
                            <input type="text" id="view_rotulo" name="view_rotulo" class="view-only" readonly placeholder="1 (Ensayo-1)" title="Solo lectura">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <label class="view-only-label"><i data-lucide="map-pin"></i> Ubicaci√≥n (Etapa / Campo / Turno)</label>
                            <div class="input-group-triple">
                                <select id="view_etapa" name="view_etapa" class="view-only" tabindex="-1" title="Solo lectura" aria-readonly="true">
                                    <option value="" disabled selected>Etapa</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                    <option value="6">6</option>
                                    <option value="7">7</option>
                                    <option value="8">8</option>
                                    <option value="9">9</option>
                                    <option value="10">10</option>
                                    <option value="11">11</option>
                                    <option value="12">12</option>
                                    <option value="13">13</option>
                                    <option value="14">14</option>
                                    <option value="15">15</option>
                                </select>
                                <select id="view_campo" name="view_campo" class="view-only" tabindex="-1" title="Solo lectura" aria-readonly="true">
                                    <option value="" disabled selected>Campo</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                    <option value="6">6</option>
                                    <option value="7">7</option>
                                    <option value="8">8</option>
                                    <option value="9">9</option>
                                    <option value="10">10</option>
                                    <option value="11">11</option>
                                    <option value="12">12</option>
                                    <option value="13">13</option>
                                    <option value="14">14</option>
                                    <option value="15">15</option>
                                </select>
                                <input type="text" id="view_turno" name="view_turno" class="view-only" readonly placeholder="Turno" maxlength="2" title="Solo lectura">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <label class="view-only-label"><i data-lucide="leaf"></i> Variedad</label>
                            <input type="text" id="view_variedad" name="view_variedad" class="view-only" readonly placeholder="VENTURA" style="text-transform: uppercase;" title="Solo lectura">
                        </div>
                        <div class="col">
                            <label class="view-only-label"><i data-lucide="truck"></i> N¬∞ Placa Camioneta</label>
                            <input type="text" id="view_placa" name="view_placa" class="view-only" readonly placeholder="M81-787" style="text-transform: uppercase;" title="Solo lectura">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <label class="view-only-label"><i data-lucide="file-text"></i> N¬∞ Gu√≠a Despacho</label>
                            <input type="text" id="view_guia_despacho" name="view_guia_despacho" class="view-only" readonly placeholder="---" inputmode="numeric" title="Solo lectura">
                        </div>
                        <div class="col">
                            <label><i data-lucide="navigation"></i> N¬∞ Viaje</label>
                            <input type="number" id="view_n_viaje" name="view_n_viaje" placeholder="35">
                        </div>
                    </div>
                </section>

                <!-- Bloque 3: Wrappers Packing -->
                <div id="wrapper_packing_1" class="collapsible-wrapper">
                    <div class="collapsible-card">
                        <div class="card-header collapsible-toggle" data-target="body-packing-1">
                            <div class="header-info"><i data-lucide="package"></i><span>Packing 1</span></div>
                            <i data-lucide="chevron-down" class="chevron"></i>
                        </div>
                        <div class="card-body" id="body-packing-1"><p class="empty-state">Contenido pendiente.</p></div>
                    </div>
                </div>
                <div id="wrapper_packing_2" class="collapsible-wrapper">
                    <div class="collapsible-card">
                        <div class="card-header collapsible-toggle" data-target="body-packing-2">
                            <div class="header-info"><i data-lucide="package"></i><span>Packing 2</span></div>
                            <i data-lucide="chevron-down" class="chevron"></i>
                        </div>
                        <div class="card-body" id="body-packing-2"><p class="empty-state">Contenido pendiente.</p></div>
                    </div>
                </div>
                <div id="wrapper_packing_3" class="collapsible-wrapper">
                    <div class="collapsible-card">
                        <div class="card-header collapsible-toggle" data-target="body-packing-3">
                            <div class="header-info"><i data-lucide="package"></i><span>Packing 3</span></div>
                            <i data-lucide="chevron-down" class="chevron"></i>
                        </div>
                        <div class="card-body" id="body-packing-3"><p class="empty-state">Contenido pendiente.</p></div>
                    </div>
                </div>
                <div id="wrapper_packing_4" class="collapsible-wrapper">
                    <div class="collapsible-card">
                        <div class="card-header collapsible-toggle" data-target="body-packing-4">
                            <div class="header-info"><i data-lucide="package"></i><span>Packing 4</span></div>
                            <i data-lucide="chevron-down" class="chevron"></i>
                        </div>
                        <div class="card-body" id="body-packing-4"><p class="empty-state">Contenido pendiente.</p></div>
                    </div>
                </div>
                <div id="wrapper_packing_5" class="collapsible-wrapper">
                    <div class="collapsible-card">
                        <div class="card-header collapsible-toggle" data-target="body-packing-5">
                            <div class="header-info"><i data-lucide="package"></i><span>Packing 5</span></div>
                            <i data-lucide="chevron-down" class="chevron"></i>
                        </div>
                        <div class="card-body" id="body-packing-5"><p class="empty-state">Contenido pendiente.</p></div>
                    </div>
                </div>
                <div id="wrapper_packing_6" class="collapsible-wrapper">
                    <div class="collapsible-card">
                        <div class="card-header collapsible-toggle" data-target="body-packing-6">
                            <div class="header-info"><i data-lucide="package"></i><span>Packing 6</span></div>
                            <i data-lucide="chevron-down" class="chevron"></i>
                        </div>
                        <div class="card-body" id="body-packing-6"><p class="empty-state">Contenido pendiente.</p></div>
                    </div>
                </div>
                <div id="wrapper_packing_7" class="collapsible-wrapper">
                    <div class="collapsible-card">
                        <div class="card-header collapsible-toggle" data-target="body-packing-7">
                            <div class="header-info"><i data-lucide="package"></i><span>Packing 7</span></div>
                            <i data-lucide="chevron-down" class="chevron"></i>
                        </div>
                        <div class="card-body" id="body-packing-7"><p class="empty-state">Contenido pendiente.</p></div>
                    </div>
                </div>
                <div id="wrapper_packing_8" class="collapsible-wrapper">
                    <div class="collapsible-card">
                        <div class="card-header collapsible-toggle" data-target="body-packing-8">
                            <div class="header-info"><i data-lucide="package"></i><span>Packing 8</span></div>
                            <i data-lucide="chevron-down" class="chevron"></i>
                        </div>
                        <div class="card-body" id="body-packing-8"><p class="empty-state">Contenido pendiente.</p></div>
                    </div>
                </div>
            </div>

        <button type="button" id="btn-guardar-registro" class="btn-primary-blue btn-guardar-registro">
            <span class="btn-guardar-text">GUARDAR REGISTRO</span>
            <span id="spinner_guardar" class="loading-spinner btn-spinner" aria-hidden="true" style="display: none;"></span>
        </button>

        </form>

        <!-- Vista Historial (se muestra al hacer clic en men√∫ Historial) -->
        <section id="view-historial" style="display: none; margin-top: 20px;">
            <div class="form-group">
                <div class="historial-header-row">
                    <h2 style="margin: 0 0 10px 0;">Historial de registros</h2>
                    <button type="button" id="historial-btn-refresh" class="btn-historial-refresh" title="Actualizar listado y env√≠os"><i data-lucide="refresh-cw"></i> Actualizar</button>
                </div>
                <p style="margin-top: 0; color: #555; font-size: 0.9rem;">
                    Resumen por d√≠a y ensayo. <strong>Pendiente:</strong> en cola, se enviar√° al tener conexi√≥n. <strong>Subido:</strong> ya enviado. <strong>No subido (ya registrado):</strong> no se subi√≥ porque ese ensayo ya estaba registrado para esa fecha. Toca una fila para ver el detalle.
                </p>
                <div id="historial-servidor-wrap" class="historial-servidor-wrap">
                    <h3 style="margin: 0 0 6px 0; font-size: 1rem;">Registros en el servidor (por fecha)</h3>
                    <p style="margin: 0 0 8px 0; color: #666; font-size: 0.85rem;">Qu√© ensayos est√°n ya guardados; as√≠ puedes evitar duplicados.</p>
                    <div id="historial-servidor" class="historial-servidor"></div>
                </div>
                <h3 style="margin-top: 20px; margin-bottom: 8px; font-size: 1rem;">Tus env√≠os (estado)</h3>
                <div id="historial-list" class="historial-list">
                    <!-- Contenido generado por script.js -->
                </div>
            </div>
        </section>

        <!-- Recomendaciones -->
        <!-- ==================== RECOMENDACIONES ==================== -->
    <section id="view-recomendaciones" style="display: none; margin-top: 20px;">
        <div class="form-group">
        <div class="section-header">
            <h2><i data-lucide="info"></i> Recomendaciones de Uso</h2>
        </div>

        <div class="recom-section">
            <h3><i data-lucide="alert-triangle"></i> Importante: Manejo de Datos</h3>
            <div class="recom-warning-box">
                <p><strong>üö´ NO REFRESCAR LA P√ÅGINA</strong> mientras est√©s llenando formularios o guardando datos. Perder√°s la informaci√≥n no guardada.</p>
            </div>
            <ul class="recom-list">
                <li><strong>Guarda con frecuencia:</strong> Presiona el bot√≥n "Guardar Datos" regularmente para no perder tu trabajo.</li>
                <li><strong>Revisa antes de guardar:</strong> Verifica que todos los datos ingresados sean correctos.</li>
                <li><strong>Conexi√≥n a internet:</strong> La app funciona sin conexi√≥n, pero necesitas internet para sincronizar los datos con el servidor.</li>
            </ul>
        </div>

        <div class="recom-section">
            <h3><i data-lucide="upload-cloud"></i> Sincronizaci√≥n de Datos</h3>
            <ul class="recom-list">
                <li><strong>Autom√°tica:</strong> Cuando hay conexi√≥n, los datos se env√≠an autom√°ticamente al servidor.</li>
                <li><strong>Pendientes:</strong> Si est√°s sin conexi√≥n, los datos quedan guardados localmente y se sincronizar√°n cuando vuelva la conexi√≥n.</li>
                <li><strong>Verifica en Historial:</strong> Revisa el estado de tus registros (pendiente/subido) en la secci√≥n de Historial.</li>
            </ul>
        </div>

        <div class="recom-section">
            <h3><i data-lucide="help-circle"></i> ¬øTienes dudas?</h3>
            <div class="recom-help-box">
                <p><strong>Ante cualquier duda sobre la subida de datos o problemas t√©cnicos:</strong></p>
                <p>üëâ Contacta al <strong>√Årea de Manejo de Informaci√≥n</strong></p>
                <p>No intentes resolver problemas t√©cnicos por tu cuenta si no est√°s seguro.</p>
            </div>
        </div>

        <div class="recom-section">
            <h3><i data-lucide="check-circle"></i> Mejores Pr√°cticas</h3>
            <ul class="recom-list">
                <li>Completa todos los campos obligatorios (marcados con *)</li>
                <li>Usa nombres y c√≥digos correctos seg√∫n tu √°rea de trabajo</li>
                <li>Mant√©n la aplicaci√≥n actualizada instal√°ndola en tu dispositivo</li>
                <li>Reporta cualquier error o comportamiento extra√±o al √°rea t√©cnica</li>
            </ul>
        </div>
    </div>
    </section>
    
    </main>

    <script src="librerias/sweetalert2.all.min.js"></script>
    <script src="librerias/lucide.min.js"></script>

    <script type="module">
        import { updateUI } from './network.js';

        // Estado de conexi√≥n y pendientes al cargar
        updateUI();

        // Eventos online/offline para actualizar estado en tiempo real
        window.addEventListener('online', () => updateUI());
        window.addEventListener('offline', () => updateUI());

        // SweetAlert / aviso antes de cerrar o refrescar si hay datos sin guardar
        window.addEventListener('beforeunload', (e) => {
            if (window.formHasChanges) {
                e.preventDefault();
                e.returnValue = 'Tienes datos sin guardar. ¬øSeguro que quieres salir?';
            }
        });

        // Service Worker solo en producci√≥n (evita errores con Live Server)
        if ('serviceWorker' in navigator && !window.location.hostname.match(/127\.0\.0\.1|localhost/)) {
            navigator.serviceWorker.register('./service-worker.js').catch(() => {});
        }
    </script>

    <script type="module" src="script.js"></script>
</body>
</html>